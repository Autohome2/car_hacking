#!/usr/bin/env python

# all the discrete values of this message in logs, extracted with
# grep 000010C,false,0 *.csv | sed s/:/,/ | cut -d, -f7-| sort | uniq
MESSAGES = [
    bytes.fromhex(n)
    for n in (
        "001055541540010F",
        "0010555415400110",
        "0010555415400121",
        "0010555415400132",
        "010055541540010F",
        "0100555415400110",
        "0100555415400121",
        "0100555415400132",
        "0110555415400100",
        "0200555415400100",
        "0200555415400111",
        "0200555415400122",
        "0200555415400133",
        "0210555415400101",
        "0210555415400112",
        "0210555415400123",
        "0210555415400134",
        "0400555415400102",
        "0400555415400113",
        "0400555415400124",
        "0400555415400135",
        "0410555415400103",
        "0410555415400114",
        "0410555415400125",
        "0410555415400136",
        "8000555415400106",
        "8000555415400117",
        "8000555415400128",
        "8000555415400139",
        "800055541580010A",
        "800055541580011B",
        "800055541580012C",
        "800055541580013D",
        "8000555425400107",
        "8000555425400118",
        "8000555425400129",
        "800055542540013A",
        "800055542580010B",
        "800055542580011C",
        "800055542580012D",
        "800055542580013E",
        "8010555415400107",
        "8010555415400118",
        "8010555415400129",
        "801055541540013A",
    )
]

def nibble_sum(x):
    r = 0
    while x:
        r += x & 0x0f
        x = x >> 4
    return r & 0xF

for m_orig in MESSAGES:
    m = bytearray(m_orig)
    m[7] = m[7] & 0xF0  # clear checksum nibble

    res = sum(nibble_sum(n) for n in m) & 0x0F

    print(m_orig.hex(), hex(res), m_orig[7] & 0xF == res)
